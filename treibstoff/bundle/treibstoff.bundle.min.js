var ts=function(t,e){"use strict";class s{constructor(){this._subscribers={},this._suppress_events=!1}on(t,e){let s=this._subscribers[t];return void 0===s&&(this._subscribers[t]=s=[]),this._contains_subscriber(t,e)||s.push(e),this}off(t,e){const s=this._subscribers[t];if(void 0===s)return this;if(!e)return delete this._subscribers[t],this;const n=s.indexOf(e);return n>-1&&s.splice(n,1),this._subscribers[t]=s,this}trigger(t,...e){if(this._suppress_events)return;this[t]&&this[t](...e);const s=this._subscribers[t];if(!s)return this;for(let t=0;t<s.length;t++)s[t](this,...e);return this}suppress_events(t){this._suppress_events=!0,t(),this._suppress_events=!1}bind_from_options(t,e){for(const s of t)e[s]&&this.on(s,e[s])}_contains_subscriber(t,e){const s=this._subscribers[t];if(!s)return!1;for(let t=0;t<s.length;t++)if(s[t]===e)return!0;return!1}}function n(t,e,s){console.log(`DEPRECATED: ${t} is deprecated and will be removed as of ${s}. Use ${e} instead.`)}function i(t,s,n=!0){const i=e(t,s);if(n&&i.length>1)throw`Element by selector ${t} not unique.`;return i.length?i:null}function r(t,e,s=!0){const n=i(t,e,s);if(null===n)throw`Element by selector ${t} not found.`;return n}function a(t,e){e?t.removeClass("hidden"):t.addClass("hidden")}function o(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)))}function h(t,e,s){return void 0===t[e]&&(t[e]=s),t[e]}function l(t,e){return t.charAt(t.length-1)===e&&(t=t.substring(0,t.length-1)),t}function c(t){const e=document.createElement("a");e.href=t;const s=e.pathname;return l(t=`${e.protocol}//${e.host}${s}`,"/")}function d(t,e){const s=document.createElement("a");s.href=t;const n=s.search;if(e)return n||"";const i={};if(n){const t=n.substring(1,n.length).split("&");for(let e=0;e<t.length;e++){const s=t[e].split("=");i[s[0]]=s[1]}}return i}function _(t,e){const s=document.createElement("a");s.href=t;let n=l(s.pathname,"/");return e&&(n+=d(t,!0)),n}const u="http://www.w3.org/2000/svg";function p(t,e){for(const s in e)if("width"===s||"height"===s){parseFloat(e[s])>=0?t.setAttributeNS(null,s,e[s]):console.error(`Invalid value for ${s}:`,e[s],t)}else t.setAttributeNS(null,s,e[s])}function m(t,e,s){const n=document.createElementNS(u,t);return p(n,e),void 0!==s&&s.appendChild(n),n}function g(t,e){const s=m("svg",{});s.innerHTML=t.trim();const n=[],i=s.childNodes;for(let t=0;t<i.length;t++){const r=i[t];n.push(r),s.removeChild(r),void 0!==e&&e.appendChild(r)}return n}class f{constructor(t,e,s){this._inst=t,this._name=e,this._val=null,Object.defineProperty(t,e,{get:this.get.bind(this),set:this.set.bind(this),enumerable:!0}),void 0!==s&&(t[e]=s)}get(){return this._val}set(t){const e=t!==this._val;this._val=t,e&&this.trigger(`on_${this._name}`,t)}trigger(t,e){const s=this._inst;s.trigger&&s.trigger(t,e)}}class v extends f{constructor(t,e,s){super(t,e),this._ctxa="elem",s?(this._ctxa=void 0!==s.ctxa?s.ctxa:this._ctxa,this._ctx=void 0!==s.ctx?s.ctx:t[this._ctxa],this._tgt=void 0!==s.tgt?s.tgt:e):(this._ctx=t[this._ctxa],this._tgt=e);const n=s?s.val:void 0;void 0!==n&&(t[e]=n)}get name(){return this._name}get val(){return this._val}get ctx(){return this._ctx||(this._ctx=this._inst[this._ctxa]),this._ctx}get tgt(){return this._tgt}}class x extends v{set(t){e(this.ctx).css(this.tgt,t),super.set(t)}}class w extends v{constructor(t,e,s){super(t,e,s),this.extract=s?s.extract:null,this.state_evt=s&&s.state_evt?s.state_evt:"on_prop_state",this.error=!1,this.msg="",this._err_marker={},this.ctx.on("change",this._change.bind(this))}set(t){e(this.ctx).val(t),this._set(t)}_change(t){const s=e(t.currentTarget).val();this._set(s)}_set(t){(t=this._extract(t))!==this._err_marker&&super.set(t),this.extract&&this.trigger(this.state_evt,this)}_extract(t){if(this.extract)try{t=this.extract(t),this.error=!1,this.msg=""}catch(e){t=this._err_marker,this.error=!0,this.msg=e}return t}}class b extends v{constructor(t,e,s){super(t,e,s),this.ctx.on("mousedown",this._down.bind(this)),this.ctx.on("mouseup",this._up.bind(this)),this.ctx.on("click",this._click.bind(this))}set(t){this.ctx.text(t),super.set(t)}_down(t){this.trigger(`on_${this.name}_down`,this)}_up(t){this.trigger(`on_${this.name}_up`,this)}_click(t){this.trigger(`on_${this.name}_click`,this)}}class y{walk(t){const e=t.childNodes;for(const t of e)this.walk(t);t.nodeType===Node.ELEMENT_NODE&&this.parse(t)}parse(t){}node_attrs(t){const e={};for(const s of t.attributes)s?.nodeName&&(e[s.nodeName]=s.nodeValue);return e}}class j extends y{constructor(t){super(),this.widget=t,this.handlers={}}parse(t){const e=this.node_attrs(t),s=this.wrap_node(t);this.handle_elem_attr(s,e);const n=t.tagName.toLowerCase(),i=this.handlers[n];i&&i(s,e)}wrap_node(t){return t}handle_elem_attr(t,e){const s=e["t-elem"];s&&(this.widget[s]=t)}}function k(t){const e=Number(t);if(Number.isNaN(e))throw"Input is not a number";return e}class $ extends j{constructor(t){super(t),this.handlers={input:this.handle_input.bind(this),select:this.handle_select.bind(this),button:this.handle_button.bind(this)},this.extractors={number:k}}wrap_node(t){return e(t)}handle_input(t,e){const s=e["t-prop"];if(!s)return;let n=this.widget,i=this.extractors[e["t-type"]];e["t-extract"]&&(i=n[e["t-extract"]]);let r=e["t-val"];i&&(r=i(r)),new w(n,s,{ctx:t,ctxa:e["t-elem"],val:r,extract:i,state_evt:e["t-state-evt"]})}handle_select(t,e){const s=e["t-options"];if(s)for(const e of JSON.parse(s))t.append(`<option value="${e[0]}">${e[1]}</option>`);this.handle_input(t,e)}handle_button(t,e){const s=e["t-prop"];if(!s)return;const n=this.widget;new b(n,s,{ctx:t,ctxa:e["t-elem"],val:e["t-val"]});for(const t of["down","up","click"])if(e[`t-bind-${t}`]){const i=n[e[`t-bind-${t}`]].bind(n);this.widget.on(`on_${s}_${t}`,i)}}}function C(t,s,n){const i=e(s.trim());n&&n.append(i);const r=new $(t);return i.each((function(){r.walk(this)})),i}class A extends j{}var E=[];class S extends y{parse(t){const s=t._ajax_attached;if(void 0!==s){for(const t of s)void 0!==t.destroy?t.destroy():console.warn(`ts.ajax bound but no destroy method defined: ${t.constructor.name}`);t._ajax_attached=null}for(const e of E)e(t);e(t).off().removeData().empty()}}function T(t){t=t instanceof e?t.get(0):t;let s=new S;s.walk(t),s=null}function O(t){E.includes(t)?console.warn(`Warning: Ajax destroy handle already registered, skipping registration: ${t}`):E.push(t)}class q extends s{constructor(t){super(),this.uid=t.uid?t.uid:o(),this.flavor=t.flavor?t.flavor:"",this.css=t.css?t.css:"",this.title=t.title?t.title:"&nbsp;",this.content=t.content?t.content:"",this.bind_from_options(["on_open","on_close"],t),this.container=t.container?t.container:e("body"),this.compile(),this.elem.data("overlay",this),this.is_open=!1}compile(){let t=1055;t+=e(".modal:visible").length,C(this,`\n          <div class="modal-wrapper position-absolute" t-elem="wrapper" style="z-index: ${t}">\n            <div class="modal-backdrop opacity-25" t-elem="backdrop"></div>\n            <div class="modal ${this.flavor} ${this.css}" id="${this.uid}" t-elem="elem">\n              <div class="modal-dialog">\n                <div class="modal-content">\n                  <div class="modal-header">\n                    <h5 class="modal-title">${this.title}</h5>\n                    <button class="btn-close close" t-prop="close_btn" t-bind-click="close">\n                      <span class="visually-hidden">Close</span>\n                    </button>\n                  </div>\n                  <div class="modal-body" t-elem="body">${this.content}</div>\n                  <div class="modal-footer" t-elem="footer"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        `)}open(){e("body").addClass("modal-open"),this.container.append(this.wrapper),this.elem.show(),this.is_open=!0,this.trigger("on_open")}close(){1===e(".modal:visible").length&&e("body").removeClass("modal-open"),T(this.wrapper),this.wrapper.remove(),this.is_open=!1,this.trigger("on_close")}}function N(t){const s=e(`#${t}`);if(!s.length)return null;const n=s.data("overlay");return n||null}class P extends q{constructor(t){t.content=t.message?t.message:t.content,super(t),this.compile_actions()}compile_actions(){C(this,'\n          <button class="btn p-0 text-primary text-decoration-underline link-offset-2 close allowMultiSubmit"\n                  t-prop="f_close_btn" t-bind-click="close">Close</button>\n        ',this.footer)}}function D(t){new P({title:t.title,message:t.message,flavor:t.flavor,css:t.css,on_open:t=>{e("button",t.elem).first().focus()}}).open()}function I(t,e){D({title:"Info",message:t,flavor:"info",css:e})}function L(t,e){D({title:"Warning",message:t,flavor:"warning",css:e})}function F(t,e){D({title:"Error",message:t,flavor:"error",css:e})}class M extends P{constructor(t){h(t,"css","dialog"),super(t),this.bind_from_options(["on_confirm"],t)}compile_actions(){C(this,'\n          <button class="ok btn btn-primary allowMultiSubmit"\n                  t-prop="ok_btn">OK</button>\n          <button class="cancel btn btn-outline-primary allowMultiSubmit"\n                  t-prop="cancel_btn" t-bind-click="close">Cancel</button>\n        ',this.footer)}on_ok_btn_click(){this.close(),this.trigger("on_confirm")}}function W(t){new M({title:t.title,message:t.message,on_confirm:t.on_confirm}).open()}class G{constructor(){this._count=0}compile(){C(this,'\n          <div id="t-loading-spinner" t-elem="elem" class="spinner-border text-primary" role="status">\n            <span class="visually-hidden">Loading...</span>\n          </div>\n        ')}show(){this._count++,this._count>1||(this.compile(),e("body").append(this.elem))}hide(t){if(this._count--,t)return this._count=0,this.elem&&this.elem.remove(),void(this.elem=null);this._count<=0&&(this._count=0,this.elem&&this.elem.remove(),this.elem=null)}}const R=new G;class H{constructor(t){this.spinner=h(t,"spinner",null),this.default_403=h(t,"default_403","/login"),this._win=h(t,"win",window)}execute(t){if(-1!==t.url.indexOf("?")){const e=t.params;t.params=d(t.url),t.url=c(t.url);for(const s in e)t.params[s]=e[s]}else h(t,"params",{});h(t,"error",((t,e,s)=>{403!==parseInt(e,10)?F(`<strong>${e}</strong>${s}`):this.redirect(this.default_403)})),this.show_spinner(),e.ajax({url:t.url,dataType:h(t,"type","html"),data:t.params,method:h(t,"method","GET"),success:(e,s,n)=>{this.hide_spinner(),t.success(e,s,n)},error:(e,s,n)=>{0!==e.status?(s=e.status||s,n=e.statusText||n,this.hide_spinner(!0),t.error(e,s,n)):this.hide_spinner(!0)},cache:h(t,"cache",!1)})}redirect(t){const e=this._win.location;e.hash="",e.pathname=t}show_spinner(){null!==this.spinner&&this.spinner.show()}hide_spinner(t){null!==this.spinner&&this.spinner.hide(t)}}function V(t){new H({spinner:h(t,"spinner",R),win:h(t,"win",window),default_403:h(t,"default_403","/login")}).execute(t)}class B extends s{parse_target(t){return{url:t?c(t):void 0,params:t?d(t):{},path:t?_(t):void 0,query:t?d(t,!0):void 0}}parse_definition(t){return t.replace(/\s+/g," ").split(" ")}action_target(t,e){return e.ajaxtarget?e.ajaxtarget:this.parse_target(t.attr("ajax:target"))}}class z extends B{constructor(t){super(),this.event=t.event,this.dispatcher=t.dispatcher,this.dispatcher.on(this.event,this.handle.bind(this))}execute(t){throw"Abstract AjaxOperation does not implement execute"}handle(t,e){throw"Abstract AjaxOperation does not implement handle"}}class U extends z{constructor(t){h(t,"event","on_action"),super(t),this.spinner=t.spinner,this._handle=t.handle,this._request=t.request}execute(t){t.success=this.complete.bind(this),this.request(t)}request(t){t.params["ajax.action"]=t.name,t.params["ajax.mode"]=t.mode,t.params["ajax.selector"]=t.selector,this._request.execute({url:`${c(t.url)}/ajaxaction`,type:"json",params:t.params,success:t.success})}complete(t){t?(this._handle.update(t),this._handle.next(t.continuation)):(F("Empty Response"),this.spinner.hide())}handle(t,e){const s=e.target,n=e.action;for(const t of this.parse_definition(n)){const e=t.split(":");this.execute({name:e[0],selector:e[1],mode:e[2],url:s.url,params:s.params})}}}class J extends B{bind(t,s){e(t).off(s).on(s,this.dispatch_handle.bind(this))}dispatch_handle(t){t.preventDefault(),t.stopPropagation();const s=e(t.currentTarget),n={elem:s,event:t};s.attr("ajax:confirm")?W({message:s.attr("ajax:confirm"),on_confirm:function(t){this.dispatch(n)}.bind(this)}):this.dispatch(n)}dispatch(t){const e=t.elem,s=t.event;e.attr("ajax:action")&&this.trigger("on_action",{target:this.action_target(e,s),action:e.attr("ajax:action")}),e.attr("ajax:event")&&this.trigger("on_event",{target:e.attr("ajax:target"),event:e.attr("ajax:event")}),e.attr("ajax:overlay")&&this.trigger("on_overlay",{target:this.action_target(e,s),overlay:e.attr("ajax:overlay"),css:e.attr("ajax:overlay-css"),uid:e.attr("ajax:overlay-uid"),title:e.attr("ajax:overlay-title")}),e.attr("ajax:path")&&this.trigger("on_path",{elem:e,event:s})}}class K extends z{constructor(t){t.event="on_event",super(t)}execute(t){const s=this.create_event.bind(this);e(t.selector).each((function(){e(this).trigger(s(t.name,t.target,t.data))}))}create_event(t,s,n){const i=e.Event(t);return s.url?i.ajaxtarget=s:i.ajaxtarget=this.parse_target(s),i.ajaxdata=n,i}handle(t,e){const s=e.target,n=e.event;for(const t of this.parse_definition(n)){const e=t.split(":");this.execute({name:e[0],selector:e[1],target:s})}}}class X{constructor(t){this.handle=t.handle,this.spinner=t.spinner,this.afr=null}bind(t){this.afr||C(this,'\n              <iframe t-elem="afr" id="ajaxformresponse"\n                      name="ajaxformresponse" src="about:blank"\n                      style="width:0px;height:0px;display:none">\n              </iframe>\n            ',e("body")),e(t).append('<input type="hidden" name="ajax" value="1" />').attr("target","ajaxformresponse").off().on("submit",function(t){this.spinner.show()}.bind(this))}render(t){this.spinner.hide(),t.error||(this.afr.remove(),this.afr=null),t.payload&&this.handle.update(t),this.handle.next(t.next)}}class Y extends B{constructor(t){super(),this.ajax=t,this.spinner=t.spinner}destroy(t){const e=new S;t.each((function(){e.walk(this)}))}update(t){let s,n=t.payload,i=t.selector,r=t.mode;if("replace"===r){const t=e(i);this.destroy(t),t.replaceWith(n),s=e(i),s.length?this.ajax.bind(s.parent()):this.ajax.bind(e(document))}else"inner"===r&&(s=e(i),this.destroy(s.children()),s.html(n),this.ajax.bind(s))}next(t){if(t&&t.length){this.spinner.hide();for(const s of t){const t=s.type;if(delete s.type,"path"===t)this.ajax.path(s);else if("action"===t){const t=this.parse_target(s.target);s.url=t.url,s.params=t.params,this.ajax.action(s)}else if("event"===t)this.ajax.trigger(s);else if("overlay"===t){const t=this.parse_target(s.target);s.url=t.url,s.params=t.params,this.ajax.overlay(s)}else"message"===t&&(s.flavor?D({message:s.payload,flavor:s.flavor,css:s.css?s.css:"",title:s.title?s.title:""}):e(s.selector).html(s.payload))}}}}class Q extends U{constructor(t){t.event="on_overlay",super(t),this.overlay_content_sel=".modal-body"}execute(t){let e,s,n;if(t.close)return e=N(t.uid),e&&e.close(),e;if(t.target){let e=t.target;e.url||(e=this.parse_target(e)),s=e.url,n=e.params}else s=t.url,n=t.params;const i=t.uid?t.uid:o();return n["ajax.overlay-uid"]=i,e=new q({uid:i,css:t.css,title:t.title,on_close:t.on_close}),this.request({name:t.action,selector:`#${i} ${this.overlay_content_sel}`,mode:"inner",url:s,params:n,success:function(t){t.payload?(e.open(),this.complete(t)):this.complete(t)}.bind(this)}),e}handle(t,e){const s=e.target,n=e.overlay;n.indexOf("CLOSE")>-1?this.execute({close:!0,uid:n.indexOf(":")>-1?n.split(":")[1]:e.uid}):this.execute({action:n,url:s.url,params:s.params,css:e.css,uid:e.uid,title:e.title})}}class Z extends y{constructor(t){super(),this.dispatcher=t.dispatcher,this.form=t.form}parse(t){const e=this.node_attrs(t);if(e["ajax:bind"]&&(e["ajax:action"]||e["ajax:event"]||e["ajax:overlay"])){const s=e["ajax:bind"];this.dispatcher.bind(t,s)}e["ajax:form"]&&this.form.bind(t),"form"===t.tagName.toLowerCase()&&t.className.split(" ").includes("ajax")&&this.form.bind(t)}}class tt extends z{constructor(t){t.event="on_path",super(t),this.win=t.win,e(this.win).on("popstate",this.state_handle.bind(this))}execute(t){const e=this.win.history;if(void 0===e.pushState)return;const s="/"!==t.path.charAt(0)?`/${t.path}`:t.path;h(t,"target",this.win.location.origin+s),h(t,"replace",!1);const n=t.replace;delete t.path,delete t.replace,t._t_ajax=!0,n?e.replaceState(t,"",s):e.pushState(t,"",s)}state_handle(t){const e=t.originalEvent.state;if(!e)return;if(!e._t_ajax)return;let s;t.preventDefault(),s=e.target.url?e.target:this.parse_target(e.target),s.params.popstate="1",e.action&&this.dispatcher.trigger("on_action",{target:s,action:e.action}),e.event&&this.dispatcher.trigger("on_event",{target:s,event:e.event}),e.overlay&&this.dispatcher.trigger("on_overlay",{target:s,overlay:e.overlay,css:e.overlay_css,uid:e.overlay_uid,title:e.overlay_title}),e.action||e.event||e.overlay||(this.win.location=s.url)}handle(t,e){let s,n=e.elem,i=e.event,r=n.attr("ajax:path");if("href"===r){r=_(n.attr("href"),!0)}else if("target"===r){const t=this.action_target(n,i);r=t.path+t.query}if(this.has_attr(n,"ajax:path-target")){const t=n.attr("ajax:path-target");t&&(s=this.parse_target(t))}else s=this.action_target(n,i);const a={path:r,target:s};a.action=this.attr_val(n,"ajax:path-action","ajax:action"),a.event=this.attr_val(n,"ajax:path-event","ajax:event"),a.overlay=this.attr_val(n,"ajax:path-overlay","ajax:overlay"),a.overlay&&(a.overlay_css=this.attr_val(n,"ajax:path-overlay-css","ajax:overlay-css"),a.overlay_uid=this.attr_val(n,"ajax:path-overlay-uid","ajax:overlay-uid"),a.overlay_title=this.attr_val(n,"ajax:path-overlay-title","ajax:overlay-title")),this.execute(a)}has_attr(t,e){const s=t.attr(e);return void 0!==s&&!1!==s}attr_val(t,e,s){return this.has_attr(t,e)?t.attr(e):t.attr(s)}}class et extends B{constructor(t=window){super(),this.win=t,this.binders={},this.spinner=R,this.dispatcher=new J,this._request=new H({win:t});const e=this.spinner,s=this.dispatcher,n=this._request;this._path=new tt({dispatcher:s,win:t}),this._event=new K({dispatcher:s});const i=new Y(this),r={dispatcher:s,win:t,handle:i,spinner:e,request:n};this._action=new U(r),this._overlay=new Q(r),this._form=new X({handle:i,spinner:e}),this._is_bound=!1}register(t,e){let s=`binder_${o()}`;for(;void 0!==this.binders[s];)s=`binder_${o()}`;this.binders[s]=t,e&&this._is_bound&&t()}bind(t){this._is_bound=!0;const e=new Z({dispatcher:this.dispatcher,form:this._form});t.each((function(){e.walk(this)}));for(const e in this.binders)try{this.binders[e](t)}catch(t){console.log(t)}return t}attach(t,s){if(s instanceof e){if(1!==s.length)throw`${t.constructor.name}: Instance can be attached to exactly one DOM element`;s=s[0]}void 0===s._ajax_attached&&(s._ajax_attached=[]),s._ajax_attached.push(t)}path(t){this._path.execute(t)}action(t){this._action.execute(t)}trigger(...t){let e;t.length>1?(n("Calling Ajax.event with positional arguments","opts","1.0"),e={name:t[0],selector:t[1],target:t[2],data:t[3]}):e=t[0],this._event.execute(e)}overlay(t){return this._overlay.execute(t)}form(t){this._form.render(t)}parseurl(t){return n("ts.ajax.parseurl","ts.parse_url","1.0"),c(t)}parsequery(t,e){return n("ts.ajax.parsequery","ts.parse_query","1.0"),d(t,e)}parsepath(t,e){return n("ts.ajax.parsepath","ts.parse_path","1.0"),_(t,e)}parsetarget(t){return n("ts.ajax.parsetarget","ts.ajax.parse_target","1.0"),this.parse_target(t)}message(t,e=""){n("ts.ajax.message","ts.show_message","1.0"),D({message:t,flavor:e})}info(t){n("ts.ajax.info","ts.show_info","1.0"),I(t)}warning(t){n("ts.ajax.warning","ts.show_warning","1.0"),L(t)}error(t){n("ts.ajax.error","ts.show_error","1.0"),F(t)}dialog(t,e){n("ts.ajax.dialog","ts.show_dialog","1.0"),W({message:t.message,on_confirm:()=>{e(t)}})}request(t){n("ts.ajax.request","ts.http_request","1.0"),V(t)}}const st=new et;function nt(t){let e=window.bootstrap.Dropdown.getInstance(t),s=window.bootstrap.Tooltip.getInstance(t);e&&e.dispose(),s&&s.dispose(),e=null,s=null}e.fn.tsajax=function(){return st.bind(this),this},e((()=>{void 0!==window.bootstrap&&O(nt)}));class it{constructor(t,...e){this._request_id=window.requestAnimationFrame((s=>{t(s,...e)}))}cancel(){null!==this._request_id&&(window.cancelAnimationFrame(this._request_id),this._request_id=null)}}class rt{constructor(t,e,...s){this._timeout_id=window.setTimeout((()=>{t(document.timeline.currentTime,...s)}),e)}cancel(){null!==this._timeout_id&&(window.clearTimeout(this._timeout_id),this._timeout_id=null)}}class at{constructor(t,e,...s){this._interval_id=window.setInterval((()=>{t(document.timeline.currentTime,this,...s)}),e)}cancel(){null!==this._interval_id&&(window.clearInterval(this._interval_id),this._interval_id=null)}}class ot{schedule_frame(t,...e){return new it(t,...e)}schedule_timeout(t,e,...s){return new rt(t,e,...s)}schedule_interval(t,e,...s){return new at(t,e,...s)}}const ht=new ot;class lt extends s{static _drag_source=null;constructor(){super(),this._drag_scope=null,this._drop_scope=null,this._dragstart_handle=null,this._dragend_handle=null,this._dragover_handle=null,this._dragleave_handle=null,this._drop_handle=null}set_scope(t,e){this.reset_scope(),this._drag_scope=t,this._drop_scope=e,t&&(t.attr("draggable","true"),this._dragstart_handle=this._dragstart.bind(this),this._dragend_handle=this._dragend.bind(this),t.on("dragstart",this._dragstart_handle),t.on("dragend",this._dragend_handle)),e&&(this._dragover_handle=this._dragover.bind(this),this._dragleave_handle=this._dragleave.bind(this),this._drop_handle=this._drop.bind(this),e.on("dragover",this._dragover_handle),e.on("dragleave",this._dragleave_handle),e.on("drop",this._drop_handle))}reset_scope(){this._drag_scope&&(this._drag_scope.off("dragstart",this._dragstart_handle),this._drag_scope.off("dragend",this._dragend_handle),this._drag_scope.removeAttr("draggable")),this._drop_scope&&(this._drop_scope.off("dragover",this._dragover_handle),this._drop_scope.off("dragleave",this._dragleave_handle),this._drop_scope.off("drop",this._drop_handle)),this._drag_scope=null,this._drop_scope=null}_dragstart(t){t.originalEvent.dataTransfer.setData("text/plain",""),lt._drag_source=this,this.trigger("dragstart",t)}_dragover(t){t.originalEvent.preventDefault(),t.source=lt._drag_source,this.trigger("dragover",t)}_dragleave(t){this.trigger("dragleave",t)}_drop(t){t.originalEvent.preventDefault(),t.source=lt._drag_source,this.trigger("drop",t)}_dragend(t){lt._drag_source=null,this.trigger("dragend",t)}}function ct(t,e=null){if(!((e=e||s)===s||e.prototype instanceof s))throw"Base class must be subclass of or Events";return class extends e{constructor(n){e===s?super():super(n);let i=this.elem;if(i||void 0===n||(i=this.elem=n.elem),!i)throw"No element found";this.event=t,this.trigger_event=this.trigger_event.bind(this),this.elem.on(this.event,this.trigger_event),st.attach(this,this.elem)}trigger_event(e){this.trigger(`on_${t}`,e)}destroy(){this.elem.off(this.event,this.trigger_event)}}}const dt=ct("click"),_t=ct("change"),ut=t=>ct("change",t);class pt extends s{constructor(){super(),this._down_handle=null,this._down_scope=null,this._move_scope=null}reset_state(){this._move_handle=null,this._up_handle=null,this._prev_pos=null,this._motion=null}set_scope(t,s){if(this._up_handle)throw"Attempt to set motion scope while handling";this.reset_state(),this._down_handle&&e(this._down_scope).off("mousedown",this._down_handle),this._down_handle=this._mousedown.bind(this),this._down_scope=t,e(t).on("mousedown",this._down_handle),this._move_scope=s||null}_mousedown(t){t.stopPropagation(),this._motion=!1,this._prev_pos={x:t.pageX,y:t.pageY},this._move_scope&&(this._move_handle=this._mousemove.bind(this),e(this._move_scope).on("mousemove",this._move_handle)),this._up_handle=this._mouseup.bind(this),e(document).on("mouseup",this._up_handle),this.trigger("down",t)}_mousemove(t){t.stopPropagation(),this._motion=!0,t.motion=this._motion,t.prev_pos=this._prev_pos,this.trigger("move",t),this._prev_pos.x=t.pageX,this._prev_pos.y=t.pageY}_mouseup(t){t.stopPropagation(),this._move_scope&&e(this._move_scope).off("mousemove",this._move_handle),e(document).off("mouseup",this._up_handle),t.motion=this._motion,this.trigger("up",t),this.reset_state()}}class mt extends pt{constructor(t){super(),this.children=[],new f(this,"parent"),this.parent=t.parent||null}add_widget(t){t.parent=this,this.children.push(t)}remove_widget(t){t.parent=null,this.children.splice(this.children.indexOf(t),1)}acquire(t){let e=this.parent;for(;e&&e&&!(e instanceof t);)e=e.parent;return e}}class gt extends mt{constructor(t){super(t),this.elem=t.elem,new x(this,"x",{tgt:"left"}),new x(this,"y",{tgt:"top"}),new x(this,"width"),new x(this,"height")}get offset(){return e(this.elem).offset()}}class ft extends s{constructor(t){if(!t.elem)throw"No element given";super(),this.elem=t.elem}get visible(){return!this.elem.hasClass("hidden")}set visible(t){const e=t!==!this.elem.hasClass("hidden");a(this.elem,t),e&&this.trigger("on_visible",t)}get hidden(){return!this.visible}set hidden(t){this.visible=!t}}function vt(t,e){if(t.elem)return t.elem;const s=t.form,n=t.name;return r(`${e}-${s.name}-${n}`,s.elem,!0)}class xt extends s{constructor(t){super(),this.form=t.form,this.name=t.name,this.elem=vt(t,"#input")}get value(){return this.elem.val()}set value(t){this.elem.val(t)}get disabled(){return this.elem.prop("disabled")}set disabled(t){this.elem.prop("disabled",t)}}class wt extends(ut(xt)){constructor(t){t.elem=vt(t,"#input"),super(t)}get options(){return this.elem.prop("options")}set options(t){this.clear();const e=this.elem[0];for(const s of t)s instanceof Option?e.add(s):e.add(new Option(s[1],s[0]))}clear(){this.elem.empty()}}class bt extends(ut(xt)){constructor(t){t.elem=vt(t,"#input"),super(t)}get checked(){return this.elem.is(":checked")}set checked(t){this.elem.prop("checked",t)}}return e((()=>{st.spinner.hide(),e(document).tsajax()})),t.Ajax=et,t.AjaxAction=U,t.AjaxDestroy=S,t.AjaxDispatcher=J,t.AjaxEvent=K,t.AjaxForm=X,t.AjaxHandle=Y,t.AjaxOperation=z,t.AjaxOverlay=Q,t.AjaxParser=Z,t.AjaxPath=tt,t.AjaxUtil=B,t.AttrProperty=class extends v{set(t){this.ctx.attr(this.tgt,t),super.set(t)}},t.BoundProperty=v,t.Button=class extends dt{constructor(t){super(t),this.unselected_class=t.unselected_class??"btn-primary",this.selected_class=t.selected_class??"btn-success"}get selected(){return this.elem.hasClass(this.selected_class)}set selected(t){t?this.elem.removeClass(this.unselected_class).addClass(this.selected_class):this.elem.removeClass(this.selected_class).addClass(this.unselected_class)}},t.ButtonProperty=b,t.CSSProperty=x,t.ChangeListener=_t,t.ClickListener=dt,t.Clock=ot,t.ClockFrameEvent=it,t.ClockIntervalEvent=at,t.ClockTimeoutEvent=rt,t.Collapsible=class{constructor(t){if(!t.elem)throw"No element given";this.elem=t.elem}get collapsed(){return!this.elem.hasClass("show")}set collapsed(t){t?this.elem.collapse("hide"):this.elem.collapse("show")}},t.DataProperty=class extends v{constructor(t,e,s){s?s.ctx=void 0!==s.ctx?s.ctx:t.data:s={ctx:t.data},s.ctxa="data",super(t,e,s)}set(t){this.ctx[this.tgt]=t,super.set(t)}},t.Dialog=M,t.DnD=lt,t.Events=s,t.Form=class{static initialize(t,e,s){const n=i(`#form-${s}`,t,!0);if(!n)return;const r=new e({name:s,elem:n});n.data(s,r)}static instance(t){return e(`#form-${t}`).data(t)}constructor(t){this.name=t.name,this.elem=t.elem}set_field_visibility(t,e){for(const s of t)s.visible=e}},t.FormCheckbox=bt,t.FormField=class extends ft{constructor(t){t.elem=vt(t,"#field"),super(t),this.form=t.form,this.name=t.name;let e=t.input;!e||e instanceof xt||(e=new e({form:this.form,name:this.name})),this.input=e}get has_error(){return this.elem.hasClass("has-error")}set has_error(t){const e=this.elem;t?e.addClass("has-error"):e.removeClass("has-error")}reset(t=""){this.input.value=t,this.has_error=!1,e(".help-block",this.elem).remove()}},t.FormInput=xt,t.FormRemoteSelect=class extends wt{constructor(t){super(t),this.vocab=t.vocab}fetch(t){V({type:"json",url:this.vocab,params:t,success:function(t,e,s){this.options=t}.bind(this)})}},t.FormSelect=wt,t.HTMLParser=$,t.HTMLWidget=gt,t.HTTPRequest=H,t.InputProperty=w,t.KeyState=class extends s{constructor(t){super(),this.filter_keyevent=t,this._keys=[],this._add_key("ctrl",17),this._add_key("shift",16),this._add_key("alt",18),this._add_key("enter",13),this._add_key("esc",27),this._add_key("delete",46),this.bind()}unload(){e(window).off("keydown",this._on_dom_keydown).off("keyup",this._on_dom_keyup)}bind(){this._on_dom_keydown=this._on_dom_keydown.bind(this),this._on_dom_keyup=this._on_dom_keyup.bind(this),e(window).on("keydown",this._on_dom_keydown).on("keyup",this._on_dom_keyup)}_add_key(t,e){this._keys.push(t),this[`_${t}`]=!1,Object.defineProperty(this,t,{get:function(){return this[`_${t}`]},set:function(s){const n=this[`_${t}`];"keydown"===s.type?n||s.keyCode!==e||(this[`_${t}`]=!0):n&&s.keyCode===e&&(this[`_${t}`]=!1)}})}_set_keys(t){for(const e of this._keys)this[e]=t}_filter_event(t){return this.filter_keyevent?.(t)}_on_dom_keydown(t){this._set_keys(t),this._filter_event(t)||this.trigger("keydown",t)}_on_dom_keyup(t){this._set_keys(t),this._filter_event(t)||this.trigger("keyup",t)}},t.LoadingSpinner=G,t.Message=P,t.Motion=pt,t.Overlay=q,t.Parser=y,t.Property=f,t.SVGContext=class extends gt{constructor(t){const e=t.parent.elem.get(0);t.elem=m("svg",{class:t.name},e),super(t),this.svg_ns=u,this.xyz={x:0,y:0,z:1}}svg_attrs(t,e){p(t,e)}svg_elem(t,e,s){return m(t,e,s)}},t.SVGParser=A,t.SVGProperty=class extends v{set(t){const e={};e[this._name]=t,p(this.ctx,e),super.set(t)}},t.TemplateParser=j,t.TextProperty=class extends v{set(t){this.ctx.text(t),super.set(t)}},t.Visibility=ft,t.WS_STATE_CLOSED=3,t.WS_STATE_CLOSING=2,t.WS_STATE_CONNECTING=0,t.WS_STATE_OPEN=1,t.Websocket=class extends s{constructor(t,e=WebSocket){super(),this._ws_factory=e,this.path=t,this.on_open=this.on_open.bind(this),this.on_close=this.on_close.bind(this),this.on_error=this.on_error.bind(this),this.on_message=this.on_message.bind(this),this.on_raw_message=this.on_raw_message.bind(this),this.sock=null}get uri(){let t;return t="http:"===window.location.protocol?"ws://":"wss://",t+window.location.hostname+this.path}get state(){return this.sock.readyState}open(){null!==this.sock&&this.sock.close(),this.sock=new this._ws_factory(this.uri);const t=this.sock;t.onopen=function(){this.trigger("on_open")}.bind(this),t.onclose=function(t){this.trigger("on_close",t)}.bind(this),t.onerror=function(){this.trigger("on_error")}.bind(this),t.onmessage=function(t){this.trigger("on_raw_message",t)}.bind(this)}send(t){this.sock.send(t)}send_json(t){this.sock.send(JSON.stringify(t))}close(){null!==this.sock&&(this.sock.close(),this.sock=null)}on_open(){}on_close(t){}on_error(){}on_message(t){}on_raw_message(t){const e=JSON.parse(t.data);void 0===e.HEARTBEAT&&this.trigger("on_message",e)}},t.Widget=mt,t.ajax=st,t.ajax_destroy=T,t.changeListener=ut,t.clickListener=t=>ct("click",t),t.clock=ht,t.compile_svg=function(t,e,s){const n=g(e,s),i=new A(t);return n.forEach(((t,e)=>{i.walk(t)})),n},t.compile_template=C,t.create_cookie=function(t,e,s){let n,i;s?(n=new Date,n.setTime(n.getTime()+24*s*60*60*1e3),i=`; expires=${n.toGMTString()}`):i="",document.cookie=`${t}=${escape(e)}${i}; path=/;`},t.create_listener=ct,t.create_svg_elem=m,t.deprecate=n,t.extract_number=k,t.get_elem=r,t.get_overlay=N,t.http_request=V,t.json_merge=function(t,e){const s={};for(const n of[t,e])for(const t in n)s[t]=n[t];return s},t.load_svg=function(t,s){e.get(t,(t=>{const n=e(t).find("svg");n.removeAttr("xmlns:a"),s(n)}).bind(this),"xml")},t.lookup_form_elem=vt,t.object_by_path=function(t){if(!t)return null;let e=window;for(const s of t.split("."))if(e=e[s],void 0===e)throw`Object by path not exists: ${t}`;return e},t.parse_path=_,t.parse_query=d,t.parse_svg=g,t.parse_url=c,t.query_elem=i,t.read_cookie=function(t){let e,s,n=`${t}=`,i=document.cookie.split(";");for(e=0;e<i.length;e+=1){for(s=i[e];" "===s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(n))return decodeURIComponent(s.substring(n.length,s.length))}return null},t.register_ajax_destroy_handle=O,t.set_default=h,t.set_svg_attrs=p,t.set_visible=a,t.show_dialog=W,t.show_error=F,t.show_info=I,t.show_message=D,t.show_warning=L,t.spinner=R,t.svg_ns=u,t.unregister_ajax_destroy_handle=function(t){const e=E.indexOf(t);e>-1?E.splice(e,1):console.warn("Warning: Ajax destroy handle is not registered and cannot be unregistered: "+t)},t.uuid4=o,Object.defineProperty(t,"__esModule",{value:!0}),window.treibstoff=t,window.bdajax=t.ajax,e.fn.bdajax=e.fn.tsajax,t}({},jQuery);
